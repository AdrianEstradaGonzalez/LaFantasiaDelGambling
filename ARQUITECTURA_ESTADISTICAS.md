# ARQUITECTURA DEL SISTEMA DE ESTAD√çSTICAS Y PUNTUACI√ìN

## üéØ Resumen

Este documento describe la nueva arquitectura **backend-first** del sistema de estad√≠sticas y puntuaci√≥n de jugadores en DreamLeague.

### Principios de dise√±o:
1. **Backend centraliza toda la l√≥gica** - C√°lculos de puntos y procesamiento de datos
2. **Frontend solo visualiza** - Consume datos ya procesados del backend
3. **Base de datos como √∫nica fuente de verdad** - Estad√≠sticas reales almacenadas
4. **Configuraci√≥n encapsulada** - Sistema de puntos en archivo centralizado

---

## üìä Flujo de Datos

```
API-Football ‚Üí Backend Service ‚Üí Base de Datos ‚Üí Backend API ‚Üí Frontend
                    ‚Üì
              Calcula puntos
              seg√∫n config
```

### 1. **API Football** (Fuente externa)
- Proporciona estad√≠sticas reales de partidos
- Endpoint: `/fixtures/players`

### 2. **Backend Service** (`playerStats.service.ts`)
- Consulta API Football
- Extrae estad√≠sticas reales
- **Calcula puntos** usando `shared/pointsCalculator.ts`
- Almacena en BD (`player_stats` table)

### 3. **Base de Datos** (`PlayerStats` model)
- Almacena estad√≠sticas reales de cada jugador por jornada
- Guarda puntos ya calculados (`totalPoints`)
- Cach√© en tabla `Player` (`lastJornadaPoints`, `lastJornadaNumber`)

### 4. **Backend API** (`playerStats.controller.ts`)
- Expone endpoints REST
- Retorna estad√≠sticas + puntos calculados
- NO repite c√°lculos (ya est√°n en BD)

### 5. **Frontend** (`PlayerStatsService.ts`)
- Consume datos del backend
- Formatea para UI
- **NO calcula puntos** - solo muestra

---

## üóÑÔ∏è Modelo de Base de Datos

### Tabla `player_stats`

| Campo | Tipo | Descripci√≥n |
|-------|------|-------------|
| `id` | UUID | Identificador √∫nico |
| `playerId` | Int | FK a `player` |
| `jornada` | Int | N√∫mero de jornada (1-38) |
| `season` | Int | Temporada (default: 2025) |
| `fixtureId` | Int | ID del partido en API |
| `teamId` | Int | ID del equipo |
| **`totalPoints`** | **Int** | **Puntos calculados (DreamLeague)** |
| `minutes` | Int? | Minutos jugados |
| `position` | String? | Posici√≥n en el partido |
| `rating` | String? | Valoraci√≥n del jugador |
| `goals` | Int? | Goles marcados |
| `assists` | Int? | Asistencias |
| `conceded` | Int? | Goles encajados (portero) |
| `saves` | Int? | Paradas (portero) |
| `shotsOn` | Int? | Tiros a puerta |
| `passesKey` | Int? | Pases clave |
| `tacklesInterceptions` | Int? | Intercepciones |
| `duelsWon` | Int? | Duelos ganados |
| `dribblesSuccess` | Int? | Regates exitosos |
| `foulsDrawn` | Int? | Faltas recibidas |
| `yellowCards` | Int? | Tarjetas amarillas |
| `redCards` | Int? | Tarjetas rojas |
| ... | ... | M√°s estad√≠sticas detalladas |

**√çndices:**
- `@@unique([playerId, jornada, season])` - Una entrada por jugador/jornada/temporada
- `@@index([playerId, jornada])` - Consultas r√°pidas por jugador
- `@@index([jornada, season])` - Consultas r√°pidas por jornada

---

## üîß Backend Services

### `playerStats.service.ts`

#### Funci√≥n principal: `getPlayerStatsForJornada()`
```typescript
async function getPlayerStatsForJornada(
  playerId: number,
  jornada: number,
  options?: { season?: number; forceRefresh?: boolean }
): Promise<PlayerStats>
```

**Flujo:**
1. Buscar en BD (si no es `forceRefresh`)
2. Si no existe ‚Üí consultar API Football
3. Calcular puntos con `calculatePlayerPoints()` (shared)
4. Guardar en BD con `prisma.playerStats.upsert()`
5. Actualizar cach√© en tabla `Player`
6. Retornar estad√≠sticas completas

#### Otras funciones:
- `getPlayerStatsForMultipleJornadas()` - Batch processing
- `updateAllPlayersStatsForJornada()` - Job autom√°tico post-jornada
- `extractStats()` - Normaliza datos de API

---

## üåê Backend API Endpoints

### 1. Obtener estad√≠sticas de una jornada
```
GET /player-stats/:playerId/jornada/:jornada
```

**Query params:**
- `season` (opcional) - Default: 2025
- `refresh` (opcional) - Forzar rec√°lculo

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "cm5...",
    "playerId": 284,
    "jornada": 15,
    "season": 2025,
    "totalPoints": 8,
    "minutes": 90,
    "goals": 1,
    "assists": 1,
    "rating": "7.5",
    // ... m√°s estad√≠sticas
  }
}
```

### 2. Obtener m√∫ltiples jornadas
```
POST /player-stats/:playerId/multiple-jornadas
```

**Body:**
```json
{
  "jornadas": [13, 14, 15],
  "season": 2025,
  "refresh": false
}
```

**Response:**
```json
{
  "success": true,
  "data": [
    { /* stats jornada 13 */ },
    { /* stats jornada 14 */ },
    { /* stats jornada 15 */ }
  ],
  "count": 3
}
```

### 3. Actualizar jornada completa (Admin)
```
POST /player-stats/update-jornada
```

**Body:**
```json
{
  "jornada": 15
}
```

**Response:**
```json
{
  "success": true,
  "message": "Estad√≠sticas actualizadas para jornada 15",
  "data": {
    "jornada": 15,
    "totalPlayers": 500,
    "successCount": 495,
    "errorCount": 5
  }
}
```

---

## üì± Frontend Service

### `PlayerStatsService.ts`

**Responsabilidades:**
- ‚úÖ Hacer requests HTTP al backend
- ‚úÖ Manejar autenticaci√≥n (JWT token)
- ‚úÖ Formatear datos para la UI
- ‚ùå **NO** calcular puntos
- ‚ùå **NO** procesar estad√≠sticas de API

#### M√©todos principales:

##### 1. `getPlayerJornadaStats()`
```typescript
async getPlayerJornadaStats(
  playerId: number,
  jornada: number,
  options?: { season?: number; refresh?: boolean }
): Promise<PlayerStats>
```

**Uso:**
```typescript
const stats = await PlayerStatsService.getPlayerJornadaStats(284, 15);
console.log(`Puntos: ${stats.totalPoints}`); // Ya calculados por backend
```

##### 2. `getPlayerMultipleJornadasStats()`
```typescript
async getPlayerMultipleJornadasStats(
  playerId: number,
  jornadas: number[],
  options?: { season?: number; refresh?: boolean }
): Promise<(PlayerStats | null)[]>
```

**Uso:**
```typescript
const stats = await PlayerStatsService.getPlayerMultipleJornadasStats(
  284,
  [13, 14, 15]
);

const totalPuntos = stats
  .filter(s => s !== null)
  .reduce((sum, s) => sum + s.totalPoints, 0);
```

##### 3. `formatStatsForDisplay()`
```typescript
formatStatsForDisplay(
  stats: PlayerStats,
  role: string
): Array<{ label: string; cantidad: number | string; puntos: string }>
```

**Uso:**
```typescript
const display = PlayerStatsService.formatStatsForDisplay(stats, 'Goalkeeper');

// Retorna:
// [
//   { label: 'Minutos jugados', cantidad: 90, puntos: '-' },
//   { label: 'Goles', cantidad: 1, puntos: '-' },
//   { label: 'Asistencias', cantidad: 2, puntos: '-' },
//   { label: 'Paradas', cantidad: 5, puntos: '-' },
//   ...
// ]
```

**Nota:** Los puntos individuales por estad√≠stica NO se muestran en el frontend. Solo se muestra el total calculado por el backend.

---

## ‚öôÔ∏è Sistema de Puntuaci√≥n

### Archivo de configuraci√≥n: `shared/pointsConfig.ts`

Este archivo contiene **todas las reglas de puntuaci√≥n**:

```typescript
// Ejemplo: Modificar puntos por asistencia
export const BASE_POINTS = {
  ASSIST: 3,  // Cambiar aqu√≠ para modificar en toda la app
  // ...
};

// Ejemplo: Modificar cada cu√°ntos pases clave = 1 punto
export const MIDFIELDER_POINTS = {
  KEY_PASSES_PER_POINT: 2,  // Cambiar de 2 a 3, por ejemplo
  // ...
};
```

**Ubicaci√≥n:** Solo en backend (`/backend/shared/pointsConfig.ts`)

**NO** existe copia en frontend - frontend nunca necesita acceder a esta configuraci√≥n.

### Calculadora: `shared/pointsCalculator.ts`

Funci√≥n principal:
```typescript
export function calculatePlayerPoints(
  stats: any,  // Estad√≠sticas de API-Football
  role: Role   // 'Goalkeeper' | 'Defender' | 'Midfielder' | 'Attacker'
): PointsResult {
  total: number;
  breakdown: PointsBreakdownEntry[];
}
```

**Ubicaci√≥n:** Solo en backend

**Uso:** Invocada autom√°ticamente por `playerStats.service.ts`

---

## üîÑ Flujo Completo de Actualizaci√≥n

### Escenario: Admin actualiza puntos de jornada 15

1. **Admin hace request:**
```typescript
POST /player-stats/update-jornada
{ "jornada": 15 }
```

2. **Backend itera todos los jugadores:**
```typescript
for (player of players) {
  // 1. Consultar API Football
  const fixtures = await fetchMatchdayFixtures(15);
  const playerStats = await fetchFixturePlayers(fixtureId);
  
  // 2. Calcular puntos
  const role = normalizeRole(player.position);
  const points = calculatePlayerPoints(playerStats, role);
  
  // 3. Guardar en BD
  await prisma.playerStats.upsert({
    where: { playerId_jornada_season: {...} },
    create: { totalPoints: points.total, ...stats },
  });
  
  // 4. Actualizar cach√©
  await prisma.player.update({
    where: { id: playerId },
    data: { lastJornadaPoints: points.total, lastJornadaNumber: 15 },
  });
}
```

3. **Frontend consulta:**
```typescript
const stats = await PlayerStatsService.getPlayerJornadaStats(284, 15);
// stats.totalPoints = 8 (ya calculado)
```

4. **UI muestra:**
```tsx
<Text>Puntos: {stats.totalPoints}</Text>
<Text>Minutos: {stats.minutes}</Text>
<Text>Goles: {stats.goals}</Text>
```

---

## üöÄ Jobs Autom√°ticos (Futuro)

### Actualizaci√≥n post-jornada autom√°tica

**Implementaci√≥n recomendada:**
```typescript
// backend/src/jobs/updateJornadaStats.job.ts
import cron from 'node-cron';
import { PlayerStatsService } from '../services/playerStats.service';

// Ejecutar todos los lunes a las 3am (despu√©s de jornada de fin de semana)
cron.schedule('0 3 * * 1', async () => {
  console.log('[JOB] Actualizando estad√≠sticas de √∫ltima jornada...');
  
  // Detectar √∫ltima jornada
  const currentJornada = await getCurrentJornada();
  
  // Actualizar todos los jugadores
  await PlayerStatsService.updateAllPlayersStatsForJornada(currentJornada);
  
  console.log('[JOB] Actualizaci√≥n completada ‚úÖ');
});
```

---

## ‚úÖ Beneficios de esta Arquitectura

### 1. **Consistencia total**
- Los puntos se calculan UNA sola vez (en backend)
- Frontend siempre muestra datos exactos de BD
- No hay riesgo de desincronizaci√≥n

### 2. **Performance**
- Frontend no hace c√°lculos pesados
- Estad√≠sticas cached en BD
- Consultas r√°pidas por √≠ndices

### 3. **Mantenibilidad**
- Sistema de puntos en UN solo lugar
- Cambiar regla = editar `pointsConfig.ts`
- No c√≥digo duplicado

### 4. **Auditor√≠a**
- Todas las estad√≠sticas hist√≥ricas guardadas
- Posibilidad de recalcular puntos retroactivamente
- Trazabilidad completa

### 5. **Escalabilidad**
- Jobs autom√°ticos en segundo plano
- Rate limiting centralizado
- Cach√© inteligente

---

## üìù Ejemplos de Uso

### Ejemplo 1: Mostrar estad√≠sticas de un jugador en una jornada

**Frontend (PlayerDetail.tsx):**
```typescript
import { PlayerStatsService } from '../../services/PlayerStatsService';

// Obtener estad√≠sticas
const stats = await PlayerStatsService.getPlayerJornadaStats(player.id, 15);

// Mostrar puntos (ya calculados)
<Text style={styles.points}>{stats.totalPoints} pts</Text>

// Formatear detalles
const display = PlayerStatsService.formatStatsForDisplay(stats, player.position);

{display.map(item => (
  <View key={item.label}>
    <Text>{item.label}: {item.cantidad}</Text>
  </View>
))}
```

### Ejemplo 2: Calcular puntos totales de √∫ltimas 3 jornadas

**Frontend:**
```typescript
const jornadas = [13, 14, 15];
const statsArray = await PlayerStatsService.getPlayerMultipleJornadasStats(
  player.id,
  jornadas
);

const totalPuntos = statsArray
  .filter(s => s !== null)
  .reduce((sum, s) => sum + s.totalPoints, 0);

console.log(`Total √∫ltimas 3 jornadas: ${totalPuntos} puntos`);
```

### Ejemplo 3: Admin actualiza puntos despu√©s de jornada

**Admin Panel:**
```typescript
const handleUpdateJornada = async () => {
  try {
    const result = await fetch(`${API_URL}/player-stats/update-jornada`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`,
      },
      body: JSON.stringify({ jornada: 15 }),
    });

    const data = await result.json();
    console.log(`‚úÖ ${data.data.successCount} jugadores actualizados`);
  } catch (error) {
    console.error('Error:', error);
  }
};
```

---

## üîç Troubleshooting

### Problema: "Puntos no se actualizan"

**Soluci√≥n:**
1. Verificar que el backend haya ejecutado el c√°lculo
2. Revisar tabla `player_stats` en BD:
```sql
SELECT * FROM player_stats WHERE "playerId" = 284 AND jornada = 15;
```
3. Si no existe, forzar refresh:
```typescript
const stats = await PlayerStatsService.getPlayerJornadaStats(
  284, 
  15, 
  { refresh: true }  // Forzar rec√°lculo
);
```

### Problema: "Puntos diferentes entre frontend y backend"

**Soluci√≥n:**
- Este problema NO puede ocurrir en la nueva arquitectura
- Frontend NUNCA calcula puntos
- Si ocurre, revisar que NO existan imports a `pointsCalculator` en frontend

### Problema: "API Football rate limit"

**Soluci√≥n:**
1. Configurar delays en `.env`:
```
FOOTBALL_API_DELAY_MS=500
```
2. Usar endpoint batch para m√∫ltiples jornadas
3. Implementar sistema de cola con Bull/BullMQ

---

## üìö Referencias

- **Prisma Schema:** `backend/prisma/schema.prisma`
- **Backend Service:** `backend/src/services/playerStats.service.ts`
- **Backend Controller:** `backend/src/controllers/playerStats.controller.ts`
- **Backend Routes:** `backend/src/routes/playerStats.routes.ts`
- **Frontend Service:** `frontend/services/PlayerStatsService.ts`
- **Points Config:** `backend/shared/pointsConfig.ts` (¬°NO en frontend!)
- **Points Calculator:** `backend/shared/pointsCalculator.ts` (¬°NO en frontend!)

---

## üé® Diagrama de Arquitectura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      API FOOTBALL                           ‚îÇ
‚îÇ                   (Estad√≠sticas reales)                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  BACKEND SERVICE                            ‚îÇ
‚îÇ           playerStats.service.ts                            ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  1. Consulta API Football                                   ‚îÇ
‚îÇ  2. Extrae estad√≠sticas                                     ‚îÇ
‚îÇ  3. Calcula puntos (pointsCalculator.ts)                    ‚îÇ
‚îÇ  4. Guarda en BD                                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    BASE DE DATOS                            ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ  ‚îÇ  player_stats                           ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  id, playerId, jornada, season          ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  totalPoints ‚úÖ (calculado)             ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  minutes, goals, assists, ...           ‚îÇ               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ  ‚îÇ  player                                 ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  id, name, position, teamId             ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  lastJornadaPoints (cache)              ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  lastJornadaNumber (cache)              ‚îÇ               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   BACKEND API                               ‚îÇ
‚îÇ          playerStats.controller.ts                          ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  GET /player-stats/:id/jornada/:jornada                     ‚îÇ
‚îÇ  POST /player-stats/:id/multiple-jornadas                   ‚îÇ
‚îÇ  POST /player-stats/update-jornada (admin)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  FRONTEND SERVICE                           ‚îÇ
‚îÇ           PlayerStatsService.ts                             ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚ùå NO calcula puntos                                       ‚îÇ
‚îÇ  ‚úÖ Solo consume API del backend                            ‚îÇ
‚îÇ  ‚úÖ Formatea para UI                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    REACT NATIVE UI                          ‚îÇ
‚îÇ          PlayerDetail.tsx, MiPlantilla.tsx                  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Muestra:                                                   ‚îÇ
‚îÇ  - Puntos totales (stats.totalPoints)                       ‚îÇ
‚îÇ  - Estad√≠sticas (stats.goals, stats.assists, ...)          ‚îÇ
‚îÇ  - Rating (stats.rating)                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚ú® Pr√≥ximos Pasos

### Fase 1: Migraci√≥n (COMPLETADA ‚úÖ)
- [x] Crear tabla `PlayerStats`
- [x] Implementar `playerStats.service.ts`
- [x] Crear endpoints REST
- [x] Crear `PlayerStatsService.ts` en frontend
- [x] Documentar arquitectura

### Fase 2: Actualizaci√≥n de UI
- [ ] Actualizar `PlayerDetail.tsx` para usar nuevo servicio
- [ ] Actualizar `MiPlantilla.tsx` para consumir backend
- [ ] Remover `pointsCalculator` de frontend
- [ ] Remover `pointsConfig` de frontend

### Fase 3: Jobs autom√°ticos
- [ ] Implementar job de actualizaci√≥n post-jornada
- [ ] Sistema de notificaciones cuando stats est√©n listas
- [ ] Cron job para limpiar estad√≠sticas antiguas

### Fase 4: Optimizaciones
- [ ] Implementar Redis cache
- [ ] Optimizar queries con Prisma
- [ ] Implementar pagination para consultas masivas
- [ ] Monitoring y alertas

---

**Fecha de creaci√≥n:** 2025-01-20  
**Autor:** DreamLeague Dev Team  
**Versi√≥n:** 1.0
